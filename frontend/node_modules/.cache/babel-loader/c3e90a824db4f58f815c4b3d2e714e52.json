{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useWebSocket = void 0;\n\nvar react_1 = require(\"react\");\n\nvar constants_1 = require(\"./constants\");\n\nvar create_or_join_1 = require(\"./create-or-join\");\n\nvar get_url_1 = require(\"./get-url\");\n\nvar proxy_1 = __importDefault(require(\"./proxy\"));\n\nvar util_1 = require(\"./util\");\n\nexports.useWebSocket = function (url, options, connect) {\n  if (options === void 0) {\n    options = constants_1.DEFAULT_OPTIONS;\n  }\n\n  if (connect === void 0) {\n    connect = true;\n  }\n\n  var _a = react_1.useState(null),\n      lastMessage = _a[0],\n      setLastMessage = _a[1];\n\n  var _b = react_1.useState({}),\n      readyState = _b[0],\n      setReadyState = _b[1];\n\n  var lastJsonMessage = react_1.useMemo(function () {\n    if (lastMessage) {\n      try {\n        return JSON.parse(lastMessage.data);\n      } catch (e) {\n        return constants_1.UNPARSABLE_JSON_OBJECT;\n      }\n    }\n\n    return null;\n  }, [lastMessage]);\n  var convertedUrl = react_1.useRef(null);\n  var webSocketRef = react_1.useRef(null);\n  var startRef = react_1.useRef(function () {\n    return void 0;\n  });\n  var reconnectCount = react_1.useRef(0);\n  var messageQueue = react_1.useRef([]);\n  var webSocketProxy = react_1.useRef(null);\n  var optionsCache = react_1.useRef(options);\n  optionsCache.current = options;\n  var readyStateFromUrl = convertedUrl.current && readyState[convertedUrl.current] !== undefined ? readyState[convertedUrl.current] : url !== null && connect === true ? constants_1.ReadyState.CONNECTING : constants_1.ReadyState.UNINSTANTIATED;\n  var stringifiedQueryParams = options.queryParams ? JSON.stringify(options.queryParams) : null;\n  var sendMessage = react_1.useCallback(function (message) {\n    if (constants_1.isEventSourceSupported && webSocketRef.current instanceof EventSource) {\n      console.warn('Unable to send a message from an eventSource');\n      return;\n    }\n\n    if (webSocketRef.current && webSocketRef.current.readyState === constants_1.ReadyState.OPEN) {\n      util_1.assertIsWebSocket(webSocketRef.current);\n      webSocketRef.current.send(message);\n    } else {\n      messageQueue.current.push(message);\n    }\n  }, []);\n  var sendJsonMessage = react_1.useCallback(function (message) {\n    sendMessage(JSON.stringify(message));\n  }, [sendMessage]);\n  var getWebSocket = react_1.useCallback(function () {\n    if (optionsCache.current.share !== true || constants_1.isEventSourceSupported && webSocketRef.current instanceof EventSource) {\n      return webSocketRef.current;\n    }\n\n    if (webSocketProxy.current === null && webSocketRef.current) {\n      util_1.assertIsWebSocket(webSocketRef.current);\n      webSocketProxy.current = proxy_1.default(webSocketRef.current, startRef);\n    }\n\n    return webSocketProxy.current;\n  }, []);\n  react_1.useEffect(function () {\n    if (url !== null && connect === true) {\n      var removeListeners_1;\n      var expectClose_1 = false;\n\n      var start_1 = function () {\n        return __awaiter(void 0, void 0, void 0, function () {\n          var _a, protectedSetLastMessage, protectedSetReadyState;\n\n          return __generator(this, function (_b) {\n            switch (_b.label) {\n              case 0:\n                _a = convertedUrl;\n                return [4\n                /*yield*/\n                , get_url_1.getUrl(url, optionsCache)];\n\n              case 1:\n                _a.current = _b.sent();\n\n                protectedSetLastMessage = function (message) {\n                  if (!expectClose_1) {\n                    setLastMessage(message);\n                  }\n                };\n\n                protectedSetReadyState = function (state) {\n                  if (!expectClose_1) {\n                    setReadyState(function (prev) {\n                      var _a;\n\n                      return __assign(__assign({}, prev), convertedUrl.current && (_a = {}, _a[convertedUrl.current] = state, _a));\n                    });\n                  }\n                };\n\n                removeListeners_1 = create_or_join_1.createOrJoinSocket(webSocketRef, convertedUrl.current, protectedSetReadyState, optionsCache, protectedSetLastMessage, startRef, reconnectCount, sendMessage);\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      };\n\n      startRef.current = function () {\n        if (!expectClose_1) {\n          if (webSocketProxy.current) webSocketProxy.current = null;\n          removeListeners_1 === null || removeListeners_1 === void 0 ? void 0 : removeListeners_1();\n          start_1();\n        }\n      };\n\n      start_1();\n      return function () {\n        expectClose_1 = true;\n        if (webSocketProxy.current) webSocketProxy.current = null;\n        removeListeners_1 === null || removeListeners_1 === void 0 ? void 0 : removeListeners_1();\n        setLastMessage(null);\n      };\n    } else if (url === null || connect === false) {\n      setReadyState(function (prev) {\n        var _a;\n\n        return __assign(__assign({}, prev), convertedUrl.current && (_a = {}, _a[convertedUrl.current] = constants_1.ReadyState.CLOSED, _a));\n      });\n    }\n  }, [url, connect, stringifiedQueryParams, sendMessage]);\n  react_1.useEffect(function () {\n    if (readyStateFromUrl === constants_1.ReadyState.OPEN) {\n      messageQueue.current.splice(0).forEach(function (message) {\n        sendMessage(message);\n      });\n    }\n  }, [readyStateFromUrl]);\n  return {\n    sendMessage: sendMessage,\n    sendJsonMessage: sendJsonMessage,\n    lastMessage: lastMessage,\n    lastJsonMessage: lastJsonMessage,\n    readyState: readyStateFromUrl,\n    getWebSocket: getWebSocket\n  };\n};","map":{"version":3,"sources":["../../src/lib/use-websocket.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useWebSocket = void 0;\nvar react_1 = require(\"react\");\nvar constants_1 = require(\"./constants\");\nvar create_or_join_1 = require(\"./create-or-join\");\nvar get_url_1 = require(\"./get-url\");\nvar proxy_1 = __importDefault(require(\"./proxy\"));\nvar util_1 = require(\"./util\");\nexports.useWebSocket = function (url, options, connect) {\n    if (options === void 0) { options = constants_1.DEFAULT_OPTIONS; }\n    if (connect === void 0) { connect = true; }\n    var _a = react_1.useState(null), lastMessage = _a[0], setLastMessage = _a[1];\n    var _b = react_1.useState({}), readyState = _b[0], setReadyState = _b[1];\n    var lastJsonMessage = react_1.useMemo(function () {\n        if (lastMessage) {\n            try {\n                return JSON.parse(lastMessage.data);\n            }\n            catch (e) {\n                return constants_1.UNPARSABLE_JSON_OBJECT;\n            }\n        }\n        return null;\n    }, [lastMessage]);\n    var convertedUrl = react_1.useRef(null);\n    var webSocketRef = react_1.useRef(null);\n    var startRef = react_1.useRef(function () { return void 0; });\n    var reconnectCount = react_1.useRef(0);\n    var messageQueue = react_1.useRef([]);\n    var webSocketProxy = react_1.useRef(null);\n    var optionsCache = react_1.useRef(options);\n    optionsCache.current = options;\n    var readyStateFromUrl = convertedUrl.current && readyState[convertedUrl.current] !== undefined ?\n        readyState[convertedUrl.current] :\n        url !== null && connect === true ?\n            constants_1.ReadyState.CONNECTING :\n            constants_1.ReadyState.UNINSTANTIATED;\n    var stringifiedQueryParams = options.queryParams ? JSON.stringify(options.queryParams) : null;\n    var sendMessage = react_1.useCallback(function (message) {\n        if (constants_1.isEventSourceSupported && webSocketRef.current instanceof EventSource) {\n            console.warn('Unable to send a message from an eventSource');\n            return;\n        }\n        if (webSocketRef.current && webSocketRef.current.readyState === constants_1.ReadyState.OPEN) {\n            util_1.assertIsWebSocket(webSocketRef.current);\n            webSocketRef.current.send(message);\n        }\n        else {\n            messageQueue.current.push(message);\n        }\n    }, []);\n    var sendJsonMessage = react_1.useCallback(function (message) {\n        sendMessage(JSON.stringify(message));\n    }, [sendMessage]);\n    var getWebSocket = react_1.useCallback(function () {\n        if (optionsCache.current.share !== true || (constants_1.isEventSourceSupported && webSocketRef.current instanceof EventSource)) {\n            return webSocketRef.current;\n        }\n        if (webSocketProxy.current === null && webSocketRef.current) {\n            util_1.assertIsWebSocket(webSocketRef.current);\n            webSocketProxy.current = proxy_1.default(webSocketRef.current, startRef);\n        }\n        return webSocketProxy.current;\n    }, []);\n    react_1.useEffect(function () {\n        if (url !== null && connect === true) {\n            var removeListeners_1;\n            var expectClose_1 = false;\n            var start_1 = function () { return __awaiter(void 0, void 0, void 0, function () {\n                var _a, protectedSetLastMessage, protectedSetReadyState;\n                return __generator(this, function (_b) {\n                    switch (_b.label) {\n                        case 0:\n                            _a = convertedUrl;\n                            return [4 /*yield*/, get_url_1.getUrl(url, optionsCache)];\n                        case 1:\n                            _a.current = _b.sent();\n                            protectedSetLastMessage = function (message) {\n                                if (!expectClose_1) {\n                                    setLastMessage(message);\n                                }\n                            };\n                            protectedSetReadyState = function (state) {\n                                if (!expectClose_1) {\n                                    setReadyState(function (prev) {\n                                        var _a;\n                                        return (__assign(__assign({}, prev), (convertedUrl.current && (_a = {}, _a[convertedUrl.current] = state, _a))));\n                                    });\n                                }\n                            };\n                            removeListeners_1 = create_or_join_1.createOrJoinSocket(webSocketRef, convertedUrl.current, protectedSetReadyState, optionsCache, protectedSetLastMessage, startRef, reconnectCount, sendMessage);\n                            return [2 /*return*/];\n                    }\n                });\n            }); };\n            startRef.current = function () {\n                if (!expectClose_1) {\n                    if (webSocketProxy.current)\n                        webSocketProxy.current = null;\n                    removeListeners_1 === null || removeListeners_1 === void 0 ? void 0 : removeListeners_1();\n                    start_1();\n                }\n            };\n            start_1();\n            return function () {\n                expectClose_1 = true;\n                if (webSocketProxy.current)\n                    webSocketProxy.current = null;\n                removeListeners_1 === null || removeListeners_1 === void 0 ? void 0 : removeListeners_1();\n                setLastMessage(null);\n            };\n        }\n        else if (url === null || connect === false) {\n            setReadyState(function (prev) {\n                var _a;\n                return (__assign(__assign({}, prev), (convertedUrl.current && (_a = {}, _a[convertedUrl.current] = constants_1.ReadyState.CLOSED, _a))));\n            });\n        }\n    }, [url, connect, stringifiedQueryParams, sendMessage]);\n    react_1.useEffect(function () {\n        if (readyStateFromUrl === constants_1.ReadyState.OPEN) {\n            messageQueue.current.splice(0).forEach(function (message) {\n                sendMessage(message);\n            });\n        }\n    }, [readyStateFromUrl]);\n    return {\n        sendMessage: sendMessage,\n        sendJsonMessage: sendJsonMessage,\n        lastMessage: lastMessage,\n        lastJsonMessage: lastJsonMessage,\n        readyState: readyStateFromUrl,\n        getWebSocket: getWebSocket,\n    };\n};\n//# sourceMappingURL=use-websocket.js.map"]},"metadata":{},"sourceType":"script"}